{% extends "layout.html" %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{% block title %}Portfolio Simulation{% endblock %}

{% block main %}
    <h1>Portfolio Monte Carlo Simulation</h1>

    <!-- Form with preserved inputs -->
    <div style="display: flex; flex-direction: column;">
        <form id="compare" method="POST" style="width: 100%; text-align: left;">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 1rem;">
                {% for field in ['Monthly', 'Year', 'NSimulations', 'future'] %}
                <div style="flex: 1;">
                    <input autocomplete="off" class="form-control" 
                           name="{{ field }}" 
                           placeholder="{{ {
                               'Monthly': 'Monthly Investments ($)',
                               'Year': 'Starting Year',
                               'NSimulations': 'Simulation Count',
                               'future': 'Years to Project'
                           }[field] }}"
                           type="number"
                           value="{{ form_data[field] if form_data else '' }}">
                </div>
                {% endfor %}
            </div>
            <div style="display: flex; justify-content: center;">
                <button class="btn btn-primary" type="submit">Calculate</button>
            </div>
        </form>
    </div>

    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    {% if plots %}
        <!-- Results Section -->
        <div class="mt-5">
            <h2>Simulation Results</h2>
            
            <!-- Line Chart -->
            <div style="position: relative; height: 400px; margin-bottom: 50px;">
                <canvas id="lineChart"></canvas>
            </div>
            
            <!-- Additional charts can be added here -->
            
            <script>
                document.addEventListener("DOMContentLoaded", function() {
                    // Line Chart
                    new Chart(
                        document.getElementById('lineChart').getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: {{ timeline | tojson }},
                                datasets: [
                                    {
                                        label: 'S&P 500 Projection',
                                        data: {{ sp500_prices | tojson }},
                                        borderColor: 'rgba(75, 192, 192, 1)',
                                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                        tension: 0.4,
                                        pointRadius: 0
                                    },
                                    {% if av_log %}
                                    {
                                        label: 'Logarithmic Model',
                                        data: {{ av_log | tojson }},
                                        borderColor: 'rgba(192, 75, 192, 1)',
                                        backgroundColor: 'rgba(192, 75, 192, 0.2)',
                                        tension: 0.4,
                                        pointRadius: 0
                                    }
                                    {% endif %}
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                interaction: {
                                    mode: 'index',
                                    intersect: false
                                },
                                scales: {
                                    y: {
                                        beginAtZero: false
                                    }
                                }
                            }
                        }
                    );
                    
                    // Add more chart initializations as needed
                });
            </script>
        </div>
    {% endif %}
{% endblock %}