{% extends "layout.html" %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{% block title %}Portfolio Simulation{% endblock %}

{% block main %}
    <!--<h1>Portfolio Monte Carlo Simulation</h1>-->

    <!-- Form with preserved inputs -->
    <div style="display: flex; flex-direction: column;">
        <form id="compare" method="POST" style="width: 100%; text-align: left;">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 1rem;">
                {% for field in ['Monthly', 'Year', 'NSimulations', 'future'] %}
                <div style="flex: 1;">
                    <input autocomplete="off" class="form-control" 
                           name="{{ field }}" 
                           placeholder="{{ {
                               'Monthly': 'Monthly Investments ($)',
                               'Year': 'Starting Year',
                               'NSimulations': 'Simulation Count',
                               'future': 'Years to Project'
                           }[field] }}"
                           type="number"
                           value="{{ form_data[field] if form_data else '' }}">
                </div>
                {% endfor %}
            </div>
            <div style="display: flex; justify-content: center;">
                <button class="btn btn-primary" type="submit">Calculate</button>
            </div>
        </form>
    </div>

    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    {% if plots %}
        <!-- Results Section -->


        <div class="mt-5">            
            <!-- Container principal com flexbox -->
            <div style="display: flex; flex-wrap: wrap; gap: 20px; justify-content: space-between;">
                <!-- Primeira linha - 2 gráficos -->
                <div style="flex: 1 1 24%; min-width: 300px; height: 400px;">
                    <canvas id="sp500"></canvas>
                </div>
                
                <div style="flex: 1 1 24%; min-width: 300px; height: 400px;">
                    <canvas id="lineplot"></canvas>
                </div>
                
                <!-- Segunda linha - 2 gráficos -->
                <div style="flex: 1 1 24%; min-width: 300px; height: 400px;">
                    <canvas id="sp_vs_exp"></canvas>
                </div>
                
                <div style="flex: 1 1 24%; min-width: 300px; height: 400px;">
                    <canvas id="diference"></canvas>
                </div>
                <div style="flex: 1 1 24%; min-width: 300px; height: 400px;">
                    <canvas id="standart_vs_weigted"></canvas>
                </div>
                <div style="flex: 1 1 24%; min-width: 300px; height: 400px;">
                    <canvas id="standart_vs_weigted_alloc"></canvas>
                </div>
                <div style="flex: 1 1 24%; min-width: 300px; height: 400px;">
                    <canvas id="standart_vs_weigted_diff"></canvas>
                </div>
                <div style="flex: 1 1 24%; min-width: 300px; height: 400px;">
                    <canvas id="montecarlo"></canvas>
                </div>
                <div style="flex: 1 1 48%; min-width: 300px; height: 400px;">
                    <canvas id="histogram"></canvas>
                </div>
            </div>
        </div>

        
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                // Line Chart
                new Chart(
                    document.getElementById('sp500').getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: {{ timeline | tojson }},
                            datasets: [
                                {
                                    label: 'S&P 500 Projection',
                                    data: {{ sp500_prices | tojson }},
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    tension: 0.4,
                                    pointRadius: 0
                                },
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false
                            },
                            scales: {
                                y: {
                                    beginAtZero: false
                                }
                            }
                        }
                    }
                );
            });
        </script>

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                // Line Chart
                new Chart(
                    document.getElementById('lineplot').getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: {{ timeline | tojson }},
                            datasets: [
                                {
                                    label: 'S&P 500 Projection',
                                    data: {{ log_sp500 | tojson }},
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    tension: 0.4,
                                    pointRadius: 0
                                },
                                {% if av_log %}
                                {
                                    label: 'Logarithmic Model',
                                    data: {{ av_log | tojson }},
                                    borderColor: 'rgba(192, 75, 192, 1)',
                                    backgroundColor: 'rgba(192, 75, 192, 0.2)',
                                    tension: 0.4,
                                    pointRadius: 0
                                }
                                {% endif %}
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false
                            },
                            scales: {
                                y: {
                                    beginAtZero: false
                                }
                            }
                        }
                    }
                );
                
                // Add more chart initializations as needed
            });
        </script>

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                // Line Chart
                new Chart(
                    document.getElementById('sp_vs_exp').getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: {{ timeline | tojson }},
                            datasets: [
                                {
                                    label: 'S&P 500 Projection',
                                    data: {{ exp_sp | tojson }},
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    tension: 0.4,
                                    pointRadius: 0
                                },
                                {% if av_log %}
                                {
                                    label: 'Logarithmic Model',
                                    data: {{ av_exp | tojson }},
                                    borderColor: 'rgba(192, 75, 192, 1)',
                                    backgroundColor: 'rgba(192, 75, 192, 0.2)',
                                    tension: 0.4,
                                    pointRadius: 0
                                }
                                {% endif %}
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false
                            },
                            scales: {
                                y: {
                                    beginAtZero: false
                                }
                            }
                        }
                    }
                );
            });
        </script>

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                // Line Chart
                new Chart(
                    document.getElementById('diference').getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: {{ timeline | tojson }},
                            datasets: [
                                {
                                    label: 'S&P 500 Projection',
                                    data: {{ diference | tojson }},
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    tension: 0.4,
                                    pointRadius: 0
                                },
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false
                            },
                            scales: {
                                y: {
                                    beginAtZero: false
                                }
                            }
                        }
                    }
                );
            });
        </script>

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                // Line Chart
                new Chart(
                    document.getElementById('standart_vs_weigted').getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: {{ timeline | tojson }},
                            datasets: [
                                {
                                    label: 'S&P 500 Projection',
                                    data: {{ s_portfolio | tojson }},
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    tension: 0.4,
                                    pointRadius: 0
                                },
                                {% if s_portfolio2 %}
                                {
                                    label: 'Logarithmic Model',
                                    data: {{ s_portfolio2 | tojson }},
                                    borderColor: 'rgba(192, 75, 192, 1)',
                                    backgroundColor: 'rgba(192, 75, 192, 0.2)',
                                    tension: 0.4,
                                    pointRadius: 0
                                }
                                {% endif %}
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false
                            },
                            scales: {
                                y: {
                                    beginAtZero: false
                                }
                            }
                        }
                    }
                );
            });
        </script>

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                // Line Chart
                new Chart(
                    document.getElementById('standart_vs_weigted_alloc').getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: {{ timeline | tojson }},
                            datasets: [
                                {
                                    label: 'S&P 500 Projection',
                                    data: {{ s_total_allocation | tojson }},
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    tension: 0.4,
                                    pointRadius: 0
                                },
                                {% if s_total_invest %}
                                {
                                    label: 'Logarithmic Model',
                                    data: {{ s_total_invest | tojson }},
                                    borderColor: 'rgba(192, 75, 192, 1)',
                                    backgroundColor: 'rgba(192, 75, 192, 0.2)',
                                    tension: 0.4,
                                    pointRadius: 0
                                }
                                {% endif %}
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false
                            },
                            scales: {
                                y: {
                                    beginAtZero: false
                                }
                            }
                        }
                    }
                );
            });
        </script>

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                // Line Chart
                new Chart(
                    document.getElementById('standart_vs_weigted_diff').getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: {{ timeline | tojson }},
                            datasets: [
                                {
                                    label: 'S&P 500 Projection',
                                    data: {{ dif | tojson }},
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    tension: 0.4,
                                    pointRadius: 0
                                },
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false
                            },
                            scales: {
                                y: {
                                    beginAtZero: false
                                }
                            }
                        }
                    }
                );
            });
        </script>
        
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                // Line Chart
                new Chart(
                    document.getElementById('montecarlo').getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: {{ future_dates | tojson }},  // Datas no eixo X
                            datasets: [
                                {
                                    label: 'S&P 500 Projection',
                                    data: {{ y_pred_future | tojson }},
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    tension: 0.4,
                                    pointRadius: 0
                                },
                                //{
                                //   label: 'Media',
                                //    data: {{ mean_values | tojson }},
                                //    borderColor: 'rgba(75, 192, 192, 1)',  // Verde
                                //    borderWidth: 2,
                                //    pointRadius: 0
                                //},
                                {
                                    label: 'Máximo (Cenário Otimista)',
                                    data: {{ max_values | tojson }},
                                    borderColor: 'rgba(255, 99, 132, 0.8)',  // Vermelho
                                    borderWidth: 1,
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    pointRadius: 0,  // Sem pontos para melhor performance
                                    fill: false
                                },
                                {
                                    label: 'Mínimo (Cenário Pessimista)',
                                    data: {{ min_values | tojson }},
                                    borderColor: 'rgba(54, 162, 235, 0.8)',  // Azul
                                    borderWidth: 1,
                                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                    pointRadius: 0,
                                    fill: '-1'  // Preenche a área entre este e o dataset anterior
                                },
                                
                            ]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Faixa de Resultados (Monte Carlo)'
                                }
                            },
                            scales: {
                                y: { beginAtZero: false }
                            }
                        }
                    }
                );
            });
        </script>
    {% endif %}
{% endblock %}